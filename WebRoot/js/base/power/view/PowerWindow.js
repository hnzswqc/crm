/*
 * File: power/view/PowerWindow.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Power.view.PowerWindow', {
    extend: 'Ext.window.Window',

    id: 'PowerWindow',
    width: 480,
    resizable: false,
    layout: {
        type: 'fit'
    },
    title: '添加功能链接',
    modal: true,
    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
        	items: [
                    {
                        xtype: 'container',
                        items: [
                            {
                                xtype: 'form',
                                frame: true,
                                id: 'PowerWindowForm',
                                bodyPadding: 10,
                                header: false,
                                margin: 2,
                                title: '功能连接表单',
                                region: 'center',
                                trackResetOnLoad:true,
                                items: [
                                    {
                                        xtype: 'textfield',
                                        anchor: '100%',
                                        fieldLabel: '名称',
                                        name: 'powerName',
                                        allowBlank: false,
                                        blankText: '不能为空'
                                    },
                                    {
                                        xtype: 'hiddenfield',
                                        anchor: '100%',
                                        fieldLabel: '功能权限Id',
                                        name: 'powerUuid',
                                        id: 'powerUuid'
                                    },
                                    {
                                        xtype: 'textfield',
                                        anchor: '100%',
                                        fieldLabel: '图标',
                                        name: 'powerIcon'
                                    },
                                    {
                                        xtype: 'textfield',
                                        anchor: '100%',
                                        fieldLabel: 'Logo',
                                        name: 'powerLogo'
                                    },
                                    {
                                        xtype: 'textfield',
                                        anchor: '100%',
                                        fieldLabel: 'URL连接',
                                        name: 'powerUrl',
                                        allowBlank: false,
                                        blankText: '不能为空',
                                        emptyText: '无连接，请以’#‘代替'
                                    },
                                    {
                                        xtype: 'textfield',
                                        anchor: '100%',
                                        fieldLabel: '所属模块',
                                        name: 'powerModelName',
                                        id: 'powerModelName',
                                        readOnly:true,
                                        allowBlank: false,
                                        hidden:true,
                                        blankText: '不能为空'
                                    },
                                    {
                                        xtype: 'treepicker',
                                        anchor: '100%',
                                        fieldLabel: '所属模块',
                                        name: 'powerModelUuid',
                                        id:'powerModelUuid',
                                        allowBlank: false,
                                        blankText: '不能为空',
                                        displayField: 'text',
                                        valueField: 'id',
                                        minPickerHeight: 20, //最小高度，不设置的话有时候下拉会出问题
                                        editable: false, //启用编辑，主要是为了清空当前的选择项
                                        autoScroll:true,
                                        //enableKeyEvents: true, //激活键盘事件
                                        forceSelection : true,// 只能选择下拉框里面的内容  
                                        store: new Ext.data.TreeStore({
                                          autoLoad:true,
                                          proxy: {
                                            type: 'ajax',
                                            url : 'model/getModelTree.do', //请求url
                                            id:'choseModelTree',
                                            extraParams:{
                                        		//获取第一个组织机构信息
                            		   	 	 	//'powerModelUuid':Ext.getCmp("PowerModelTreePanel").store.proxy.reader.jsonData[0].id
                            			 	 },
                                            reader: {
                                                type: 'json'
                                            }
                                          },
                                          root: {
                                            text: '根目录',
                                            id: DEFAULT_ROOT_UUID
                                          },
                                          scope:this,
                                          clearOnLoad: true,
                                          listeners : {

                                          }
                                        })
                                    },
                                    /*
                                    {
                                        xtype: 'hiddenfield',
                                        anchor: '100%',
                                        fieldLabel: '所属模块Id',
                                        name: 'powerModelUuid',
                                        id: 'powerModelUuid',
                                        allowBlank: false,
                                        blankText: '不能为空'
                                    },*/
                                    {
                                        xtype: 'treepicker',
                                        anchor: '100%',
                                        fieldLabel: '上级功能菜单',
                                        name: 'powerParentUuid',
                                        id:'powerParentUuid',
                                        allowBlank: false,
                                        blankText: '不能为空',
                                        displayField: 'text',
                                        valueField: 'id',
                                        minPickerHeight: 20, //最小高度，不设置的话有时候下拉会出问题
                                        editable: false, //启用编辑，主要是为了清空当前的选择项
                                        autoScroll:true,
                                        //enableKeyEvents: true, //激活键盘事件
                                        forceSelection : true,// 只能选择下拉框里面的内容  
                                        store: new Ext.data.TreeStore({
                                          model: 'Power.model.PowerModel',
                                          autoLoad:true,
                                          proxy: {
                                            type: 'ajax',
                                            url : 'power/getPowerTreeList.do', //请求url
                                            extraParams:{
                                        		//获取第一个组织机构信息
                            		   	 	 	//'powerModelUuid':Ext.getCmp("PowerModelTreePanel").store.proxy.reader.jsonData[0].id
                            			 	 },
                                            reader: {
                                                type: 'json',
                                                root:'data'
                                            }
                                          },
                                          root: {
                                            text: '根目录',
                                            id: DEFAULT_ROOT_UUID
                                          },
                                          scope:this,
                                          clearOnLoad: true,
                                          listeners: {
            	                              'beforeload':function(store, operation, eOpts){
            	              	        		try {
            	              	        			if(undefined!=store.proxy.extraParams.powerModelUuid){
            	              	        				var new_params = {
                	              								'powerParentUuid' : operation.node.data.id,
                	              								'powerModelUuid':store.proxy.extraParams.powerModelUuid
                	              						}
                	              						Ext.apply(store.proxy.extraParams, new_params);
            	              	        				retrun;
            	              	        			}
            	              	        			var id;
            	              	        			var gridPanel = Ext.getCmp("PowerModelTreePanel");
            	              	        	        var selectionModel = gridPanel.getSelectionModel();
            	              	        	        if(selectionModel.getCount()<=0){
            	              	        	        	id=Ext.getCmp("PowerGridPanel").getSelectionModel().getSelection()[0].data.powerModelUuid;
            	              	        	        }else{
            	              	        	            id=selectionModel.getSelection()[0].data.id;
            	              	        	        }
            	              	        	        
            	              	        	        
            	              						var new_params = {
            	              								'powerParentUuid' : operation.node.data.id,
            	              								'powerModelUuid':id
            	              						}
            	              						Ext.apply(store.proxy.extraParams, new_params);
            	              					} catch (e) {
            	              						//Ext.Msg.show({
            	              							//title : '提示',
            	              							//msg :'获取选中节点出错 !',
            	              							//buttons : Ext.Msg.OK,
            	              							//icon : Ext.MessageBox.ERROR
            	              						//});
            	              					} 
            	                          	}
                                        }
                                        })
                                    },
                                    {
                                        xtype: 'combobox',
                                        anchor: '100%',
                                        fieldLabel: '状态',
                                        name: 'powerState',
                                        allowBlank: false,
                                        blankText: '不能为空',
                                        displayField: 'text',
                                        valueField: 'id',
                                        editable: false, //启用编辑，主要是为了清空当前的选择项
                                        store:'PowerStateStore',
                                        listeners:{
                                          	afterrender:function(combol){
                                          		//var firstValue =combol.store.proxy.data[0].id;
                                          		//combol.setValue(firstValue);  
                                          	}
                                    	}
                                       
                                    },
                                    {
                                        xtype: 'numberfield',
                                        anchor: '100%',
                                        fieldLabel: '排序号',
                                        name: 'powerOrderby',
                                        allowBlank: false,
                                        blankText: '不能为空'
                                    },
                                    {
                                        xtype: 'textareafield',
                                        anchor: '100%',
                                        fieldLabel: '备注信息',
                                        height:100,
                                        name: 'powerNote'
                                    }
                                ]
                            },
                            {
                                xtype: 'toolbar',
                                //height: 40,
                                margin: 2,
                                items: [
                                        '->',
                                        {
                                            xtype: 'button',
                                            id: 'Power_window_add_btn',
                                            hidden:exists('Power_window_add_btn'),
                                            icon: 'img/save.png',
                                            text: '保存'
                                        },
                                        {
                                            xtype: 'button',
                                            id: 'Power_window_close_btn',
                                            margin: '0 10 0 10',
                                            icon: 'img/close.png',
                                            hidden:exists('Power_window_close_btn'),
                                            text: '关闭'
                                        }
                                ]
                            }
                        ]
                    }
                ]
            });
        me.callParent(arguments);
    }
});