/*
 * File: monthReport/controller/MonthReportController.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MonthReport.controller.MonthReportController', {
    extend: 'Ext.app.Controller',

    //刷新按钮
    onMonthReportReloadBtnClick: function(button, e, eOpts) {
		Ext.getCmp("MonthReportGridPanel").store.reload();
    },
    //明细报表
    onMonthReportDetailSearchBtnClick: function(button, e, eOpts) {
    	var gridPanel = Ext.getCmp("MonthReportGridPanel");
        var selectionModel = gridPanel.getSelectionModel();
        if(selectionModel.getCount()<=0){
       	 Ext.Msg.show({
     				title : '提示信息',
     				msg :'请选择一条信息',
     				buttons : Ext.Msg.OK,
     				icon : Ext.MessageBox.WARNING
     			});
            return;
        }
       var data =  selectionModel.getSelection()[0].data
       var params = "";
       var panel = Ext.getCmp("MonthReportSearchForm");
       if(panel.isHidden()){
    	   params = {"loggingUserNumber":data.loggingUserNumber};
       }else{
    	   var startDate = Ext.getCmp("startDate").value;
    	   if(undefined!=startDate){
    		   params = {"loggingUserNumber":data.loggingUserNumber,"month":startDate};
    	   }
       }
       
       Ext.create("MonthReport.view.LoggingDetailWindow",{title:data.loggingUserName+(undefined!=startDate?startDate:'本')+'月工资明细查询',icon:'img/detail.png'}).show();
       var gridPanel=Ext.getCmp("DetailGridPanel");
	   	gridPanel.store.setProxy({
		 	   url:'logging/getLoggingPage.do',
	           type: 'ajax',
	           extraParams:params,
	           groupField: 'loggingUserName',
	           reader: {
	   			type: 'json',
		   	  	 	//数据格式为json   
		            root: 'data'
	           }
	   	});
	   	gridPanel.store.load(); 
	   	gridPanel.setTitle(title);
       
       
    },
    //导出按钮
    onMonthReportExportBtnClick: function(button, e, eOpts) {
    	Ext.Msg.wait('正在处理数据，请稍候...','提示');
    	var panel = Ext.getCmp("MonthReportSearchForm");
        if(panel.isHidden()){
        	window.location.href=extBasePath+"logging/getDownMonthReport.do";
        	 Ext.Msg.hide();
        }else{
        	 var searchForm = Ext.getCmp("MonthReportSearchForm");
        	 if(!searchForm.isDirty()){
        		 Ext.Msg.hide();
        		 Ext.Msg.show({title : '提示信息',msg :'月度不能为空!',buttons : Ext.Msg.OK,icon : Ext.MessageBox.INFO});
        		 return;
         	 }
        	var startDate = Ext.getCmp("startDate").value;
        	var loggingUserNumber = Ext.getCmp("loggingUserNumber").value;
        	
        	window.location.href=extBasePath+"logging/getDownMonthReport.do?startDate="+startDate+"&loggingUserNumber="+(null==loggingUserNumber?"":loggingUserNumber);
        	Ext.Msg.hide();
        }
    },
    //高级查询按钮
    onMonthReportShowSearchBtnClick: function(button, e, eOpts) {
    	var panel = Ext.getCmp("MonthReportSearchForm");
        if(panel.isHidden()){
            panel.show();
        }else{
            panel.hide();
        }
    },
    //查询按钮
    onMonthReportSearchBtnClick: function(button, e, eOpts) {
    	 var searchForm = Ext.getCmp("MonthReportSearchForm");
    	 if(!searchForm.isDirty()){
    		 Ext.Msg.show({title : '提示信息',msg :'月度不能为空!',buttons : Ext.Msg.OK,icon : Ext.MessageBox.INFO});
    		 return;
     	 }
    	var startDate = Ext.getCmp("startDate").value;
    	this.reloadMonthReportGridPanelStore(searchForm.getValues(),startDate+'月工资查询');
    },
    //重置按钮
    onMonthReportResetBtnClick: function(button, e, eOpts) {
    	Ext.getCmp("startDate").setValue("");
    	Ext.getCmp("loggingUserNumber").setValue("");
    	this.reloadMonthReportGridPanelStore(null,'本月工资查询');
    },
    //重新加载数据
    reloadMonthReportGridPanelStore:function(data,title){
    	var gridPanel=Ext.getCmp("MonthReportGridPanel");
    	gridPanel.store.setProxy({
	 		url:'logging/getMonthReport.do',
            type: 'ajax',
            extraParams:data,
            groupField: 'orgName',
            reader: {
    			type: 'json',
	   	  	 	//数据格式为json   
	            root: 'data'
            }
    	});
    	gridPanel.store.load(); 
    	gridPanel.setTitle(title);
    },
    //刷新按钮
    onDetailReloadBtnClick: function(button, e, eOpts) {
		Ext.getCmp("DetailGridPanel").store.reload();
    },
    //导出明细报表
    onDetailExportBtnClick: function(button, e, eOpts) {
    	 Ext.Msg.wait('正在处理数据，请稍候...','提示');
    	 
    	 var gridPanel = Ext.getCmp("MonthReportGridPanel");
         var selectionModel = gridPanel.getSelectionModel();
         if(selectionModel.getCount()<=0){
        	 Ext.Msg.show({
      				title : '提示信息',
      				msg :'请选择一条信息',
      				buttons : Ext.Msg.OK,
      				icon : Ext.MessageBox.WARNING
      			});
             return;
         }
         
    	 var data =  selectionModel.getSelection()[0].data
         var params = "";
         var panel = Ext.getCmp("MonthReportSearchForm");
         if(panel.isHidden()){
      	   params = "loggingUserNumber="+data.loggingUserNumber;
         }else{
      	   var startDate = Ext.getCmp("startDate").value;
      	   if(undefined!=startDate){
      		   params = "loggingUserNumber="+data.loggingUserNumber+"&month="+startDate;
      	   }
         }
     	window.location.href=extBasePath+"logging/getDownDetailList.do?"+params;
     	Ext.Msg.hide();
         	
         
    },
    //关闭明细报表
    onDetailCloseBtnClick: function(button, e, eOpts) {
    	Ext.getCmp("LoggingDetailWindow").close();
    },
    init: function(application) {
        this.control({
            "button[id=MonthReportReloadBtn]": {
                click: this.onMonthReportReloadBtnClick
            },
            "button[id=MonthReportDetailSearchBtn]": {
                click: this.onMonthReportDetailSearchBtnClick
            },
            "button[id=MonthReportExportBtn]": {
                click: this.onMonthReportExportBtnClick
            },
            "button[id=MonthReportShowSearchBtn]": {
                click: this.onMonthReportShowSearchBtnClick
            },
            "button[id=MonthReportSearchBtn]": {
                click: this.onMonthReportSearchBtnClick
            },
            "button[id=MonthReportResetBtn]": {
                click: this.onMonthReportResetBtnClick
            },
            "button[id=DetailReloadBtn]": {
                click: this.onDetailReloadBtnClick
            },
            "button[id=DetailExportBtn]": {
                click: this.onDetailExportBtnClick
            },
            "button[id=DetailCloseBtn]": {
                click: this.onDetailCloseBtnClick
            }
            
        });
    }

});
